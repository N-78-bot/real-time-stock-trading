<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">  <!-- ì´ ì¤„ í™•ì¸! -->
    <title>ì‹¤ì‹œê°„ ì‹œì„¸</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        body {
            font-family: 'Malgun Gothic', Arial, sans-serif;  /* í•œê¸€ í°íŠ¸ ì¶”ê°€ */
            margin: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
        }
        #status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            background: #e3f2fd;
        }
        #prices {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .price-item {
            padding: 10px;
            margin: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .positive {
            color: #d32f2f;
            font-weight: bold;
        }
        .negative {
            color: #1976d2;
            font-weight: bold;
        }
    </style>
</head>
<body>
<h1>ğŸš€ ì‹¤ì‹œê°„ ì½”ì¸ ì‹œì„¸</h1>
<div id="status">ì—°ê²° ì¤‘...</div>
<div id="prices"></div>

<script>
    const socket = new SockJS('http://localhost:8081/ws');
    const stompClient = Stomp.over(socket);

    stompClient.connect({}, function(frame) {
        console.log('WebSocket ì—°ê²° ì„±ê³µ:', frame);
        document.getElementById('status').innerHTML = 'âœ… ì—°ê²°ë¨';
        document.getElementById('status').style.color = 'green';

        stompClient.subscribe('/topic/stock-price', function(message) {
            const data = JSON.parse(message.body);

            const changeClass = data.changeRate >= 0 ? 'positive' : 'negative';
            const changeSymbol = data.changeRate >= 0 ? '+' : '';

            const priceHtml = `
                    <div class="price-item">
                        <strong>${data.code}</strong>:
                        ${data.price.toLocaleString()}ì›
                        <span class="${changeClass}">
                            (${changeSymbol}${(data.changeRate * 100).toFixed(2)}%)
                        </span>
                        <small>${new Date(data.timestamp).toLocaleTimeString()}</small>
                    </div>
                `;

            document.getElementById('prices').innerHTML = priceHtml + document.getElementById('prices').innerHTML;

            // ìµœê·¼ 20ê°œë§Œ ìœ ì§€
            const items = document.querySelectorAll('.price-item');
            if (items.length > 20) {
                items[items.length - 1].remove();
            }
        });
    }, function(error) {
        console.error('WebSocket ì—°ê²° ì‹¤íŒ¨:', error);
        document.getElementById('status').innerHTML = 'âŒ ì—°ê²° ì‹¤íŒ¨';
        document.getElementById('status').style.color = 'red';
    });
</script>
</body>
</html>